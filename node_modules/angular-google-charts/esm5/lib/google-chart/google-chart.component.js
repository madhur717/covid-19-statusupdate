/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/// <reference types="google.visualization"/>
/// <reference types="google.visualization"/>
import { Component, ElementRef, Input, ChangeDetectionStrategy } from '@angular/core';
import { ScriptLoaderService } from '../script-loader/script-loader.service';
import { RawChartComponent } from '../raw-chart/raw-chart.component';
import * as ɵngcc0 from '@angular/core';
var GoogleChartComponent = /** @class */ (function (_super) {
    tslib_1.__extends(GoogleChartComponent, _super);
    function GoogleChartComponent(element, loaderService) {
        var _this = _super.call(this, element, loaderService) || this;
        _this.roles = new Array();
        _this.width = undefined;
        _this.height = undefined;
        _this.options = {};
        return _this;
    }
    /**
     * @return {?}
     */
    GoogleChartComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.type == null) {
            throw new Error('Can\'t create a Google Chart without specifying a type!');
        }
        if (this.data == null) {
            throw new Error('Can\'t create a Google Chart without data!');
        }
        this.chartData = {
            chartType: this.type
        };
        this.loaderService.onReady.subscribe((/**
         * @return {?}
         */
        function () {
            _this.createChart();
        }));
    };
    /**
     * @return {?}
     */
    GoogleChartComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        if (this.wrapper) {
            this.chartData = {
                chartType: this.type,
                dataTable: this.getDataTable(),
                options: this.parseOptions()
            };
        }
        _super.prototype.ngOnChanges.call(this);
    };
    /**
     * @protected
     * @return {?}
     */
    GoogleChartComponent.prototype.parseOptions = /**
     * @protected
     * @return {?}
     */
    function () {
        return tslib_1.__assign({ title: this.title, width: this.width, height: this.height }, this.options);
    };
    /**
     * @protected
     * @return {?}
     */
    GoogleChartComponent.prototype.createChart = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        this.loadNeededPackages().subscribe((/**
         * @return {?}
         */
        function () {
            _this.chartData = {
                chartType: _this.type,
                dataTable: _this.getDataTable(),
                options: _this.parseOptions()
            };
            _this.wrapper = new google.visualization.ChartWrapper();
            _this.updateChart();
        }));
    };
    /**
     * @protected
     * @return {?}
     */
    GoogleChartComponent.prototype.getDataTable = /**
     * @protected
     * @return {?}
     */
    function () {
        if (this.columnNames) {
            /** @type {?} */
            var columns = this.parseRoles(this.columnNames);
            this.firstRowIsData = false;
            return tslib_1.__spread([columns], this.data);
        }
        else {
            this.firstRowIsData = true;
            return this.data;
        }
    };
    /**
     * @private
     * @param {?} columnNames
     * @return {?}
     */
    GoogleChartComponent.prototype.parseRoles = /**
     * @private
     * @param {?} columnNames
     * @return {?}
     */
    function (columnNames) {
        /** @type {?} */
        var columnNamesWithRoles = columnNames.slice();
        if (this.roles) {
            // Roles must be copied to avoid modifying the index everytime there's a change from ngOnChanges.
            /** @type {?} */
            var copyRoles_1 = this.roles.map((/**
             * @param {?} role
             * @return {?}
             */
            function (role) { return Object.assign({}, role); }));
            copyRoles_1.forEach((/**
             * @param {?} role
             * @return {?}
             */
            function (role) {
                var e_1, _a;
                /** @type {?} */
                var roleData = {
                    type: role.type,
                    role: role.role
                };
                if (role.p) {
                    roleData.p = role.p;
                }
                if (role.index != null) {
                    columnNamesWithRoles.splice(role.index + 1, 0, roleData);
                    try {
                        for (var copyRoles_2 = tslib_1.__values(copyRoles_1), copyRoles_2_1 = copyRoles_2.next(); !copyRoles_2_1.done; copyRoles_2_1 = copyRoles_2.next()) {
                            var otherRole = copyRoles_2_1.value;
                            if (otherRole === role) {
                                continue;
                            }
                            if (otherRole.index > role.index) {
                                otherRole.index++;
                            }
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (copyRoles_2_1 && !copyRoles_2_1.done && (_a = copyRoles_2.return)) _a.call(copyRoles_2);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                }
                else {
                    columnNamesWithRoles.push(roleData);
                }
            }));
        }
        return columnNamesWithRoles;
    };
    /** @nocollapse */
    GoogleChartComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ScriptLoaderService }
    ]; };
    GoogleChartComponent.propDecorators = {
        data: [{ type: Input }],
        columnNames: [{ type: Input }],
        roles: [{ type: Input }],
        title: [{ type: Input }],
        width: [{ type: Input }],
        height: [{ type: Input }],
        options: [{ type: Input }],
        type: [{ type: Input }]
    };
GoogleChartComponent.ɵfac = function GoogleChartComponent_Factory(t) { return new (t || GoogleChartComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ScriptLoaderService)); };
GoogleChartComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: GoogleChartComponent, selectors: [["google-chart"]], inputs: { data: "data", columnNames: "columnNames", roles: "roles", title: "title", width: "width", height: "height", options: "options", type: "type" }, exportAs: ["google-chart"], features: [ɵngcc0.ɵɵInheritDefinitionFeature, ɵngcc0.ɵɵNgOnChangesFeature], decls: 0, vars: 0, template: function GoogleChartComponent_Template(rf, ctx) { }, styles: ["[_nghost-%COMP%] { width: fit-content; display: block; }"], changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(GoogleChartComponent, [{
        type: Component,
        args: [{
                // tslint:disable-next-line:component-selector
                selector: 'google-chart',
                template: '',
                exportAs: 'google-chart',
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [':host { width: fit-content; display: block; }']
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ScriptLoaderService }]; }, { data: [{
            type: Input
        }], columnNames: [{
            type: Input
        }], roles: [{
            type: Input
        }], title: [{
            type: Input
        }], width: [{
            type: Input
        }], height: [{
            type: Input
        }], options: [{
            type: Input
        }], type: [{
            type: Input
        }] }); })();
    return GoogleChartComponent;
}(RawChartComponent));
export { GoogleChartComponent };
if (false) {
    /** @type {?} */
    GoogleChartComponent.prototype.data;
    /** @type {?} */
    GoogleChartComponent.prototype.columnNames;
    /** @type {?} */
    GoogleChartComponent.prototype.roles;
    /** @type {?} */
    GoogleChartComponent.prototype.title;
    /** @type {?} */
    GoogleChartComponent.prototype.width;
    /** @type {?} */
    GoogleChartComponent.prototype.height;
    /** @type {?} */
    GoogleChartComponent.prototype.options;
    /** @type {?} */
    GoogleChartComponent.prototype.type;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsibmc6L2FuZ3VsYXItZ29vZ2xlLWNoYXJ0cy9saWIvZ29vZ2xlLWNoYXJ0L2dvb2dsZS1jaGFydC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw2Q0FBNkM7QUFDN0M7QUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFVBQVUsRUFBRSxLQUFLLEVBQUUsdUJBQXVCLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFFekcsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDN0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7O0FBR3JFO0FBRUEsSUFNMEMsZ0RBQWlCO0FBQUMsSUF5QjFELDhCQUFZLE9BQW1CLEVBQUUsYUFBa0M7QUFDckUsUUFERSxZQUNFLGtCQUFNLE9BQU8sRUFBRSxhQUFhLENBQUMsU0FDOUI7QUFDSCxRQXBCRSxXQUFLLEdBQWdCLElBQUksS0FBSyxFQUFFLENBQUM7QUFDbkMsUUFLRSxXQUFLLEdBQVcsU0FBUyxDQUFDO0FBQzVCLFFBRUUsWUFBTSxHQUFXLFNBQVMsQ0FBQztBQUM3QixRQUVFLGFBQU8sR0FBUSxFQUFFLENBQUM7QUFDcEI7QUFFVSxJQUlSLENBQUM7QUFDSDtBQUNPO0FBQ0k7QUFBUSxJQURqQix1Q0FBUTtBQUNSO0FBQW1CO0FBQ3JCLElBRkU7QUFDRCxRQURDLGlCQWVDO0FBQ0gsUUFmSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxFQUFFO0FBQzNCLFlBQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyx5REFBeUQsQ0FBQyxDQUFDO0FBQ2pGLFNBQUs7QUFDTCxRQUFJLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLEVBQUU7QUFDM0IsWUFBTSxNQUFNLElBQUksS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7QUFDcEUsU0FBSztBQUNMLFFBQ0ksSUFBSSxDQUFD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QSxBQUdBLEFBUUEsQUFBQSxBQXlCQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQW5CQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU1BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQWVBLEFBZEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFXQSxBQVZBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBbklBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUZBLEFBQUEsQUFHQSxBQWJBLEFBQUEsQUFFQSxBQUFBLEFBYUEsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFzR0EsQUFBQSxBQUFBLEFBcElBLEFBUUEsQUFBQSxBQTRIQSxBQTVIQSxBQUFBLEFBQ0EsQUFDQSxBQUVBLEFBQ0EsQUFFQSxBQUNBLEFBRUEsQUFDQSxBQUVBLEFBQ0EsQUFFQSxBQUNBLEFBRUEsQUFDQSxBQUVBLEFBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSB0eXBlcz1cImdvb2dsZS52aXN1YWxpemF0aW9uXCIvPlxyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEVsZW1lbnRSZWYsIElucHV0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgT25DaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBTY3JpcHRMb2FkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2NyaXB0LWxvYWRlci9zY3JpcHQtbG9hZGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSYXdDaGFydENvbXBvbmVudCB9IGZyb20gJy4uL3Jhdy1jaGFydC9yYXctY2hhcnQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUm9sZSB9IGZyb20gJy4uL21vZGVscy9yb2xlLm1vZGVsJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ2dvb2dsZS1jaGFydCcsXHJcbiAgdGVtcGxhdGU6ICcnLFxyXG4gIHN0eWxlczogWyc6aG9zdCB7IHdpZHRoOiBmaXQtY29udGVudDsgZGlzcGxheTogYmxvY2s7IH0nXSxcclxuICBleHBvcnRBczogJ2dvb2dsZS1jaGFydCcsXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIEdvb2dsZUNoYXJ0Q29tcG9uZW50IGV4dGVuZHMgUmF3Q2hhcnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgQElucHV0KClcclxuICBkYXRhOiBBcnJheTxBcnJheTxzdHJpbmcgfCBudW1iZXI+PjtcclxuXHJcbiAgQElucHV0KClcclxuICBjb2x1bW5OYW1lczogQXJyYXk8c3RyaW5nPjtcclxuXHJcbiAgQElucHV0KClcclxuICByb2xlczogQXJyYXk8Um9sZT4gPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgQElucHV0KClcclxuICB0aXRsZTogc3RyaW5nO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHdpZHRoOiBudW1iZXIgPSB1bmRlZmluZWQ7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgaGVpZ2h0OiBudW1iZXIgPSB1bmRlZmluZWQ7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgb3B0aW9uczogYW55ID0ge307XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgdHlwZTogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihlbGVtZW50OiBFbGVtZW50UmVmLCBsb2FkZXJTZXJ2aWNlOiBTY3JpcHRMb2FkZXJTZXJ2aWNlKSB7XHJcbiAgICBzdXBlcihlbGVtZW50LCBsb2FkZXJTZXJ2aWNlKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMudHlwZSA9PSBudWxsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuXFwndCBjcmVhdGUgYSBHb29nbGUgQ2hhcnQgd2l0aG91dCBzcGVjaWZ5aW5nIGEgdHlwZSEnKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRhdGEgPT0gbnVsbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3QgY3JlYXRlIGEgR29vZ2xlIENoYXJ0IHdpdGhvdXQgZGF0YSEnKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNoYXJ0RGF0YSA9IHtcclxuICAgICAgY2hhcnRUeXBlOiB0aGlzLnR5cGVcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5sb2FkZXJTZXJ2aWNlLm9uUmVhZHkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5jcmVhdGVDaGFydCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcygpIHtcclxuICAgIGlmICh0aGlzLndyYXBwZXIpIHtcclxuICAgICAgdGhpcy5jaGFydERhdGEgPSB7XHJcbiAgICAgICAgY2hhcnRUeXBlOiB0aGlzLnR5cGUsXHJcbiAgICAgICAgZGF0YVRhYmxlOiB0aGlzLmdldERhdGFUYWJsZSgpLFxyXG4gICAgICAgIG9wdGlvbnM6IHRoaXMucGFyc2VPcHRpb25zKClcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdXBlci5uZ09uQ2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIHBhcnNlT3B0aW9ucygpOiBhbnkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXHJcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxyXG4gICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxyXG4gICAgICAuLi50aGlzLm9wdGlvbnNcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgY3JlYXRlQ2hhcnQoKSB7XHJcbiAgICB0aGlzLmxvYWROZWVkZWRQYWNrYWdlcygpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2hhcnREYXRhID0ge1xyXG4gICAgICAgIGNoYXJ0VHlwZTogdGhpcy50eXBlLFxyXG4gICAgICAgIGRhdGFUYWJsZTogdGhpcy5nZXREYXRhVGFibGUoKSxcclxuICAgICAgICBvcHRpb25zOiB0aGlzLnBhcnNlT3B0aW9ucygpXHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0aGlzLndyYXBwZXIgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ2hhcnRXcmFwcGVyKCk7XHJcbiAgICAgIHRoaXMudXBkYXRlQ2hhcnQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGdldERhdGFUYWJsZSgpOiBBcnJheTxhbnk+IHtcclxuICAgIGlmICh0aGlzLmNvbHVtbk5hbWVzKSB7XHJcbiAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLnBhcnNlUm9sZXModGhpcy5jb2x1bW5OYW1lcyk7XHJcbiAgICAgIHRoaXMuZmlyc3RSb3dJc0RhdGEgPSBmYWxzZTtcclxuICAgICAgcmV0dXJuIFtjb2x1bW5zLCAuLi50aGlzLmRhdGFdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5maXJzdFJvd0lzRGF0YSA9IHRydWU7XHJcbiAgICAgIHJldHVybiB0aGlzLmRhdGE7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBhcnNlUm9sZXMoY29sdW1uTmFtZXM6IGFueVtdKTogYW55W10ge1xyXG4gICAgY29uc3QgY29sdW1uTmFtZXNXaXRoUm9sZXMgPSBjb2x1bW5OYW1lcy5zbGljZSgpO1xyXG4gICAgaWYgKHRoaXMucm9sZXMpIHtcclxuICAgICAgLy8gUm9sZXMgbXVzdCBiZSBjb3BpZWQgdG8gYXZvaWQgbW9kaWZ5aW5nIHRoZSBpbmRleCBldmVyeXRpbWUgdGhlcmUncyBhIGNoYW5nZSBmcm9tIG5nT25DaGFuZ2VzLlxyXG4gICAgICBjb25zdCBjb3B5Um9sZXMgPSB0aGlzLnJvbGVzLm1hcChyb2xlID0+IE9iamVjdC5hc3NpZ24oe30sIHJvbGUpKTtcclxuICAgICAgY29weVJvbGVzLmZvckVhY2gocm9sZSA9PiB7XHJcbiAgICAgICAgY29uc3Qgcm9sZURhdGE6IFJvbGUgPSB7XHJcbiAgICAgICAgICB0eXBlOiByb2xlLnR5cGUsXHJcbiAgICAgICAgICByb2xlOiByb2xlLnJvbGVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChyb2xlLnApIHtcclxuICAgICAgICAgIHJvbGVEYXRhLnAgPSByb2xlLnA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyb2xlLmluZGV4ICE9IG51bGwpIHtcclxuICAgICAgICAgIGNvbHVtbk5hbWVzV2l0aFJvbGVzLnNwbGljZShyb2xlLmluZGV4ICsgMSwgMCwgcm9sZURhdGEpO1xyXG5cclxuICAgICAgICAgIGZvciAoY29uc3Qgb3RoZXJSb2xlIG9mIGNvcHlSb2xlcykge1xyXG4gICAgICAgICAgICBpZiAob3RoZXJSb2xlID09PSByb2xlKSB7XHJcbiAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvdGhlclJvbGUuaW5kZXggPiByb2xlLmluZGV4KSB7XHJcbiAgICAgICAgICAgICAgb3RoZXJSb2xlLmluZGV4Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29sdW1uTmFtZXNXaXRoUm9sZXMucHVzaChyb2xlRGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY29sdW1uTmFtZXNXaXRoUm9sZXM7XHJcbiAgfVxyXG59XHJcbiJdfQ==